(function($){$.fn.hasAttr=function(name){return this.attr(name)!==undefined}})(jQuery);function ModalRemote(modalId){this.defaults={okLabel:"OK",executeLabel:"Execute",cancelLabel:"Cancel",loadingTitle:"Loading"};this.modal=$(modalId);this.dialog=$(modalId).find(".modal-dialog");this.header=$(modalId).find(".modal-header");this.content=$(modalId).find(".modal-body");this.footer=$(modalId).find(".modal-footer");this.loadingContent='<div class="progress progress-striped active" style="margin-bottom:0;"><div class="progress-bar" style="width: 100%"></div></div>';this.show=function(){this.clear();$(this.modal).modal("show")};this.hide=function(){$(this.modal).modal("hide")};this.toggle=function(){$(this.modal).modal("toggle")};this.clear=function(){$(this.modal).find(".modal-title").remove();$(this.content).html("");$(this.footer).html("")};this.setSize=function(size){$(this.dialog).removeClass("modal-lg");$(this.dialog).removeClass("modal-sm");$(this.dialog).removeClass("modal-x-large");if(size=="large")$(this.dialog).addClass("modal-lg");else if(size=="small")$(this.dialog).addClass("modal-sm");else if(size=="x-large")$(this.dialog).addClass("modal-x-large");else if(size!=="normal")console.warn("Undefined size "+size)};this.setHeader=function(content){$(this.header).html(content)};this.setContent=function(content){$(this.content).html(content)};this.setFooter=function(content){$(this.footer).html(content)};this.setTitle=function(title){$(this.header).find("h4.modal-title").remove();$(this.header).prepend('<h4 class="modal-title">'+title+"</h4>")};this.hidenCloseButton=function(){$(this.header).find("button.close").hide()};this.showCloseButton=function(){$(this.header).find("button.close").show()};this.displayLoading=function(){this.setContent(this.loadingContent);this.setTitle(this.defaults.loadingTitle)};this.addFooterButton=function(label,type,classes,callback){buttonElm=document.createElement("button");buttonElm.setAttribute("type",type===null?"button":type);buttonElm.setAttribute("class",classes===null?"btn btn-primary btn-sm":classes);buttonElm.innerHTML=label;var instance=this;$(this.footer).append(buttonElm);if(callback!==null){$(buttonElm).click(function(event){callback.call(instance,this,event)})}};this.doRemote=function(url,method,data){var instance=this;$.ajax({url:url,method:method,data:data,async:false,beforeSend:function(){beforeRemoteRequest.call(instance)},error:function(response){errorRemoteResponse.call(instance,response)},success:function(response){successRemoteResponse.call(instance,response)},contentType:false,cache:false,processData:false})};function beforeRemoteRequest(){this.show();this.displayLoading()}function errorRemoteResponse(response){this.setTitle(response.status+response.statusText);this.setContent(response.responseText);this.addFooterButton("Close","button","btn btn-sm btn-default",function(button,event){this.hide()})}function successRemoteResponse(response){if(response.forceReload!==undefined&&response.forceReload){if(response.forceReload=="true"){if($("#crud-datatable-pjax").length){$.pjax.reload({container:"#crud-datatable-pjax"})}}else{if($(response.forceReload).length){$.pjax.reload({container:response.forceReload})}}}if(response.forceUpdate!==undefined&&response.forceUpdate.field!==undefined&&response.forceUpdate.content!==undefined){if($(response.forceUpdate.field).length){$(response.forceUpdate.field).html(response.forceUpdate.content)}}if(response.callback!==undefined&&response.callback){try{eval(response.callback)}catch(error){}}if(response.forceClose!==undefined&&response.forceClose){this.hide();return}if(response.size!==undefined)this.setSize(response.size);if(response.title!==undefined)this.setTitle(response.title);if(response.content!==undefined)this.setContent(response.content);if(response.footer!==undefined)this.setFooter(response.footer);if($(this.content).find("form")[0]!==undefined){this.setupFormSubmit($(this.content).find("form")[0],$(this.footer).find('[type="submit"]')[0])}}this.setupFormSubmit=function(modalForm,modalFormSubmitBtn){if(modalFormSubmitBtn===undefined){console.warn("Modal has form but does not have a submit button")}else{var instance=this;$(modalFormSubmitBtn).click(function(e){var data;if(window.FormData){data=new FormData($(modalForm)[0])}else{data=$(modalForm).serializeArray()}instance.doRemote($(modalForm).attr("action"),$(modalForm).hasAttr("method")?$(modalForm).attr("method"):"GET",data)})}};this.confirmModal=function(title,message,okLabel,cancelLabel,size,dataUrl,dataRequestMethod,selectedIds){this.show();this.setSize(size);if(title!==undefined){this.setTitle(title)}this.setContent('<form id="ModalRemoteConfirmForm">'+message);var instance=this;this.addFooterButton(okLabel===undefined?this.defaults.okLabel:okLabel,"submit","btn btn-danger btn-sm float-right float-end",function(e){var data;if(window.FormData){data=new FormData($("#ModalRemoteConfirmForm")[0]);if(typeof selectedIds!=="undefined"&&selectedIds)data.append("pks",selectedIds.join())}else{data=$("#ModalRemoteConfirmForm");if(typeof selectedIds!=="undefined"&&selectedIds)data.pks=selectedIds;data=data.serializeArray()}instance.doRemote(dataUrl,dataRequestMethod,data)});this.addFooterButton(cancelLabel===undefined?this.defaults.cancelLabel:cancelLabel,"button","btn btn-sm btn-secondary float-left float-start",function(e){this.hide()})};this.open=function(elm,bulkData){if($(elm).hasAttr("data-confirm-title")||$(elm).hasAttr("data-confirm-message")){this.confirmModal($(elm).attr("data-confirm-title"),$(elm).attr("data-confirm-message"),$(elm).attr("data-confirm-ok"),$(elm).attr("data-confirm-cancel"),$(elm).hasAttr("data-modal-size")?$(elm).attr("data-modal-size"):"normal",$(elm).hasAttr("href")?$(elm).attr("href"):$(elm).attr("data-url"),$(elm).hasAttr("data-request-method")?$(elm).attr("data-request-method"):"GET",bulkData)}else{this.doRemote($(elm).hasAttr("href")?$(elm).attr("href"):$(elm).attr("data-url"),$(elm).hasAttr("data-request-method")?$(elm).attr("data-request-method"):"GET",bulkData)}}}